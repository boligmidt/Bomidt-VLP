require("source-map-support").install(),function(t){var e={};function n(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(r,s,function(e){return t[e]}.bind(null,s));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=34)}([function(t,e){t.exports=require("@babel/runtime/regenerator")},function(t,e){t.exports=require("react")},function(t,e){t.exports=require("@babel/runtime/helpers/defineProperty")},function(t,e){t.exports=require("@babel/runtime/helpers/objectWithoutProperties")},function(t,e){t.exports=require("moment")},function(t,e){t.exports=require("draftjs-to-html")},function(t,e){t.exports=require("@babel/runtime/helpers/classCallCheck")},function(t,e){t.exports=require("@babel/runtime/helpers/createClass")},function(t,e){t.exports=require("styled-components")},function(t,e){t.exports=require("request")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("@babel/runtime/helpers/typeof")},function(t,e){t.exports=require("aws-sdk")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("apollo-server-express")},function(t,e){t.exports=require("jsonwebtoken")},function(t,e){t.exports=require("jwks-rsa")},function(t,e){t.exports=require("graphql-tools")},function(t,e){t.exports=require("graphql")},function(t,e){t.exports=require("graphql-type-json")},function(t,e){t.exports=require("lodash/merge")},function(t,e){t.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(t,e){t.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(t,e){t.exports=require("@babel/runtime/helpers/inherits")},function(t,e){t.exports=require("apollo-server")},function(t,e){t.exports=require("@babel/runtime/helpers/objectDestructuringEmpty")},function(t,e){t.exports=require("@babel/runtime/helpers/extends")},function(t,e){t.exports=require("uuid/v4")},function(t,e){t.exports=require("uuid")},function(t,e){t.exports=require("@babel/polyfill")},function(t,e){t.exports=require("graphql-s2s")},function(t,e){t.exports=require("mongodb")},function(t,e,n){"use strict";n.r(e);var r=n(0),s=n.n(r),a=n(2),i=n.n(a),o=(n(31),n(14)),u=n.n(o),c=n(10),p=n.n(c),d=n(15),l=n.n(d),g=n(11),f=n.n(g),m=n(16),y=n(17),h=n.n(y),S=n(18),v=n.n(S),I=process.env.AUTH0_TENANT,b=process.env.AUTH0_AUDIENCE,w=v()({cache:!0,cacheMaxAge:36e6,jwksUri:"".concat(I,"/.well-known/jwks.json")});function x(t,e){w.getSigningKey(t.kid,(function(t,n){var r=n.publicKey||n.rsaPublicKey;e(null,r)}))}var D={audience:b,issuer:"".concat(I,"/"),algorithms:["RS256"]},O=function(t){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){h.a.verify(t,x,D,(function(t,r){if(t)return n(t);e(r)}))})));case 1:case"end":return e.stop()}}))},A=function(t,e){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,r){var a;return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,s.a.awrap(e.Users.findOne({auth0Id:t}));case 3:a=i.sent,n(a),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(0),r(i.t0);case 10:case"end":return i.stop()}}),null,null,[[0,7]])})));case 1:case"end":return n.stop()}}))},C=n(19),_=n(20),k=n(21),B=n.n(k),P=n(22),T=n.n(P),j=n(6),M=n.n(j),U=n(7),E=n.n(U),N=n(23),$=n.n(N),F=n(24),H=n.n(F),q=n(25),Q=n.n(q),L=n(26),R={admin:["*:*"],editor:["*:*"],contact:["*:read"],user:["*:read"]},V=function(t,e){for(var n in e)if(new RegExp("^"+e[n].split("*").join(".*")+"$").test(t))return!0;return!1},G=function(t){function e(){return M()(this,e),$()(this,H()(e).apply(this,arguments))}return Q()(e,t),E()(e,[{key:"visitObject",value:function(t){this.ensureFieldsWrapped(t),t._scope=this.args.scope}},{key:"visitFieldDefinition",value:function(t,e){this.ensureFieldsWrapped(e.objectType),t._scope=this.args.scope}},{key:"ensureFieldsWrapped",value:function(t){if(!t._alreadyWrapperd){t._alreadyWrapperd=!0;var e=t.getFields();Object.keys(e).forEach((function(n){var r=e[n],a=r.defaultFieldResolver,i=r.resolve;r.resolve=function(){var e,n,o,u,c,p,d,l,g,f,m,y=arguments;return s.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:for(e=r._scope||t._scope,n=y.length,o=new Array(n),u=0;u<n;u++)o[u]=y[u];if(c=o[1],p=o[2],e){s.next=6;break}return s.abrupt("return",a&&a.apply(this,o)||i&&i.apply(this,o));case 6:if(p.user){s.next=8;break}throw new Error("User not logged in");case 8:if(d=p.user.roles,l="contact",(g=d.find((function(t){return"*"!==t.housingCooperativeId})))&&(l=g.role),c.housingCooperativeId&&(g=d.find((function(t){return t.housingCooperativeId===c.housingCooperativeId})))&&(l=g.role),(f=d.find((function(t){return"*"===t.housingCooperativeId})))&&(l=f.role),V(e,m=R[l])){s.next=19;break}throw console.log(e,l,m),new Error("User dont have correct scope");case 19:return s.abrupt("return",a&&a.apply(this,o)||i&&i.apply(this,o));case 20:case"end":return s.stop()}}),null,this)}}))}}}]),e}(L.SchemaDirectiveVisitor),Y=(n(27),n(3)),z=n.n(Y);function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function K(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(n,!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function W(t,e){return function(n,r,a){var i,o;return s.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(r.createdAt=new Date,r.isDeleted=!1,i=a.uuid(),a.user&&(r.createdBy=a.user._id,r.createdByDisplayName=a.user.name),!e||!e.transformDoc){u.next=8;break}return u.next=7,s.a.awrap(e.transformDoc(n,{_id:i},r,a));case 7:r=u.sent;case 8:return u.next=10,s.a.awrap(a[t].insertOne(K({_id:i},r)));case 10:if(o=u.sent,!e||!e.afterInsert){u.next=14;break}return u.next=14,s.a.awrap(e.afterInsert(n,o.ops[0],r,a));case 14:return u.abrupt("return",o.ops[0]);case 15:case"end":return u.stop()}}))}}function Z(t,e){return function(n,r,a){var i,o,u;return s.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(i=r._id,(o=z()(r,["_id"])).updatedAt=new Date,a.user&&(o.updatedBy=a.user._id,o.updatedByDisplayName=a.user.name),!e||!e.transformDoc){c.next=7;break}return c.next=6,s.a.awrap(e.transformDoc(n,{_id:i},o,a));case 6:o=c.sent;case 7:return c.next=9,s.a.awrap(a[t].updateOne({_id:i},{$set:o}));case 9:if(c.sent.matchedCount){c.next=12;break}throw new Error("Document not found");case 12:return c.next=14,s.a.awrap(a[t].findOne({_id:i}));case 14:return u=c.sent,c.abrupt("return",u);case 16:case"end":return c.stop()}}))}}function X(t,e){return function(n,r,a){var i,o,u;return s.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return i=r._id,c.next=3,s.a.awrap(a[t].findOne({_id:i}));case 3:return(o=c.sent).updatedAt=new Date,o.isDeleted=!0,a.user&&(o.updatedBy=a.user._id,o.updatedByDisplayName=a.user.name),c.next=9,s.a.awrap(a[t].updateOne({_id:i},{$set:o}));case 9:if(u=c.sent,!e||!e.afterDelete){c.next=13;break}return c.next=13,s.a.awrap(e.afterDelete(n,u.ops[0],o,a));case 13:return c.abrupt("return",1===u.deletedCount);case 14:case"end":return c.stop()}}))}}function tt(t,e){var n=e&&e.afterFindOne||function(t,e,n,r){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return n._id,e.abrupt("return",t);case 2:case"end":return e.stop()}}))};return function(r,a,i){var o,u;return s.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(o=a,!e||!e.transformQuery){c.next=5;break}return c.next=4,s.a.awrap(e.transformQuery(r,a,o,i));case 4:o=c.sent;case 5:return c.next=7,s.a.awrap(i[t].findOne(o));case 7:return u=c.sent,c.next=10,s.a.awrap(n(u,r,a,i));case 10:return c.abrupt("return",c.sent);case 11:case"end":return c.stop()}}))}}function et(t,e){return function(n,r,a){var o,u,c,p,d,l,g,f,m,y,h;return s.a.async((function(S){for(;;)switch(S.prev=S.next){case 0:if(o=r.limit,u=r.skip,c=r.search,p=r.order,d=r.orderBy,l=z()(r,["limit","skip","search","order","orderBy"]),(g=K({},l)).isDeleted||(g.isDeleted={$ne:!0}),f=e&&e.queryArgs||[],c&&(g.$text={$search:c}),f.forEach((function(t){void 0!==l[t]&&(g[t]=l[t])})),!e||!e.transformQuery){S.next=10;break}return S.next=9,s.a.awrap(e.transformQuery(n,l,K({search:c},g),a));case 9:g=S.sent;case 10:return m=a[t].find(g).collation({locale:"nb",caseLevel:!1}),d&&m.sort(i()({},d,p||-1)),u&&m.skip(u),o&&m.limit(o),S.next=16,s.a.awrap(m.count());case 16:return y=S.sent,S.next=19,s.a.awrap(m.toArray());case 19:return h=S.sent,S.abrupt("return",{count:y,items:h});case 21:case"end":return S.stop()}}))}}function nt(t,e){return function(n,r,a,o){var u,c,p,d,l,g,f,m,y,h,S,v;return s.a.async((function(I){for(;;)switch(I.prev=I.next){case 0:if(u=r.limit,c=r.skip,p=r.search,d=r.order,l=r.orderBy,g=z()(r,["limit","skip","search","order","orderBy"]),(f=K({},g)).isDeleted||(f.isDeleted={$ne:!0}),m=e&&e.queryArgs||[],y=[],o.fieldNodes[0].selectionSet.selections.map((function(t){return y.push(t.name.value)})),p&&(f.$text={$search:p}),m.forEach((function(t){void 0!==g[t]&&(f[t]=g[t])})),!e||!e.transformQuery){I.next=12;break}return I.next=11,s.a.awrap(e.transformQuery(n,g,f,a));case 11:f=I.sent;case 12:if(h=a[t].find(f).collation({locale:"nb",caseLevel:!1}),l&&h.sort(i()({},l,d||-1)),h.skip(c||0).limit(u||25),S=null,v=null,!(y.indexOf("count")>-1)){I.next=21;break}return I.next=20,s.a.awrap(a[t].find(f).count());case 20:S=I.sent;case 21:if(!(y.indexOf("items")>-1)){I.next=25;break}return I.next=24,s.a.awrap(h.toArray());case 24:v=I.sent;case 25:if(!e||!e.afterPaginate){I.next=27;break}return I.abrupt("return",e.afterPaginate({count:S,items:v},n,K({},f,{},g),a,o));case 27:return I.abrupt("return",{count:S,items:v});case 28:case"end":return I.stop()}}))}}var rt={typeDefs:'\n\ttype Activity inherits Document {\n\t\tfileId: ID\n\t\tassessmentId: ID!\n\t\ttype: String\n\t\tuserName: String\n\t\tdiff: JSON\n\t\tcomment: String\n\t\tfile: File\n\t}\n\n\textend type Query {\n\t\tfindOneActivity(\n\t\t\t_id: ID!\n\t\t): Activity @auth(scope:"activities:read")\n\n\t\tfindActivities(\n\t\t\tassessmentId: ID!\n\t\t\ttype: String\n\t\t\tlimit: Int\n\t\t\tskip: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<Activity> @auth(scope:"activities:read")\n\n\t\tgetAssesmentActivities(\n\t\t\tassessmentId: ID!\n\t\t): [Activity] @auth(scope:"activities:read")\n\n\t\tpaginateActivities(\n\t\t\tassessmentId: ID!\n\t\t\tlimit: Int\n\t\t\tskip: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<Activity> @auth(scope:"activities:read")\n\t}\n\n\textend type Mutation {\n\t\tinsertOneActivity(\n\t\t\tassessmentId: ID!\n\t\t\ttype: String\n\t\t\tuserName: String\n\t\t\tdiff: JSON\n\t\t\tfileId: ID\n\t\t\tcomment: String\n\t\t): Activity @auth(scope:"activities:write")\n\n\t\tupdateOneActivity(\n\t\t\t_id: ID!\n\t\t\tassessmentId: ID!\n\t\t\ttype: String\n\t\t\tuserName: String\n\t\t\tdiff: JSON\n\t\t\tfileId: ID\n\t\t): Activity @auth(scope:"activities:write")\n\n\t\tdeleteOneActivity(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"activities:write")\n\t}\n\t',resolvers:{Query:{findOneActivity:tt("Activities"),findActivities:et("Activities"),getAssesmentActivities:function(t,e,n,r){var a;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(n.Activities.find({assessmentId:e.assessmentId}).sort({createdAt:-1}).toArray());case 2:return a=t.sent,t.abrupt("return",a.map((function(t){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if("file"!==!t.type&&t.fileId){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,s.a.awrap(n.Files.findOne({_id:t.fileId}));case 4:return t.file=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}))})));case 4:case"end":return t.stop()}}))},paginateActivities:nt("Activities")},Mutation:{insertOneActivity:W("Activities"),updateOneActivity:Z("Activities"),deleteOneActivity:X("Activities")}}},st=n(4),at=n.n(st),it=(n(28),n(1),n(8));n.n(it).a.svg.withConfig({displayName:"NavIcons__NavIconWrapper",componentId:"sc-1macte0-0"})(["all:unset;display:block;height:",";width:",";margin-right:",";fill:",";stroke:",";transform:rotate(",");animation:"," 0.5s 1 linear;"],(function(t){return t.height||"1.5rem"}),(function(t){return t.width||"35px"}),(function(t){return t["margin-right"]||"20px"}),(function(t){return t.fill||t.theme.colors.blue}),(function(t){return t.stroke?t.stroke:""}),(function(t){return t.rotate||"0deg"}),(function(t){return t.animation})),Object(it.keyframes)(["0%{transform:rotate(180deg);},100%{transform:rotate(0deg);}"]),Object(it.keyframes)(["0%{transform:rotate(0deg);},100%{transform:rotate(180deg);}"]);function ot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ot(n,!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ot(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ct(t,e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n=[],["name","stateLevel","description","measure","address","cost","unitAmount","productionYear","lastMaintained","dimensions","isActive","isCompleted"].forEach((function(r){e[r]!=t[r]&&n.push({from:e[r],to:t[r],key:r})})),at()(e.dueDate).isSame(at()(t.dueDate))||n.push({from:at()(e.dueDate).toDate(),to:at()(t.dueDate).toDate(),key:"dueDate"}),at()(e.createdAt).isSame(at()(t.createdAt))||n.push({from:at()(e.createdAt).toDate(),to:at()(t.createdAt).toDate(),key:"createdAt"}),r.abrupt("return",n);case 6:case"end":return r.stop()}}))}var pt={typeDefs:'\n\ttype Assessment inherits Document {\n\t\thousingCooperativeId: ID!\n\t\tcategoryId: ID\n\t\tname: String\n\t\tobjectType: String\n\t\tlifespan: [String]\n\t\tstateLevel: String\n\t\tdescription: String\n\t\tmeasure: String\n\t\taddress: ID\n\t\taddressName: String\n\t\tcost: String\n\t\tproductionYear: String\n\t\tlastMaintained: String\n\t\tunitAmount: String\n\t\tdimensions: String\n\t\tgroupKey: Int\n\t\tgroupOrder: Int\n\t\tcategory: String\n\t\tdueDate: DateTime\n\t\tprimaryImageId: ID\n\t\tisActive: Boolean\n\t\tisCompleted: Boolean\n\t\tcompletedAt: DateTime\n\t\tmodifiedAt: DateTime\n\t\tisFreshDuplicate: Boolean\n\t\tindex: Int\n\t\tfiles: [File]\n\t}\n\n\ttype SubGroup {\n\t\ttitle: String\n\t\titems: [Assessment]\n\t\tisSeparated: Boolean\n\t}\n\n\ttype AssessmentGroup {\n\t\ttitle: String\n\t\tsubGroups: [SubGroup]\n\t}\n\n\tinput AssessmentInput {\n\t\thousingCooperativeId: ID!\n\t\tstateLevel: String\n\t\taddress: ID\n\t\tcategoryId: ID\n\t\tname: String\n\t\tobjectType: String\n\t\tcategory: String\n\t\tgroupKey: Int\n\t\tgroupOrder: Int\n\t\tisCompleted: Boolean\n\t\tcompletedAt: DateTime\n\t}\n\n\textend type Query {\n\t\tfindOneAssessment(\n\t\t\t_id: ID!\n\t\t): Assessment @auth(scope:"assessments:read")\n\n\t\tfindAssessments(\n\t\t\thousingCooperativeId: ID!\n\t\t\tisActive: Boolean\n\t\t\tisDeleted: Boolean\n\t\t\tisCompleted: Boolean\n\t\t\tstateLevel: [String]\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\taddress: ID\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<Assessment> @auth(scope:"assessments:read")\n\n\t\tfindGroupedAssessments(\n\t\t\thousingCooperativeId: ID!\n\t\t\tisActive: Boolean\n\t\t\tisDeleted: Boolean\n\t\t\tisCompleted: Boolean\n\t\t\tstateLevel: [String]\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\taddress: ID\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t\tyear: Int\n\t\t): [AssessmentGroup] @auth(scope:"assessments:read")\n\n\t\tpaginateAssessments(\n\t\t\thousingCooperativeId: ID!\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t\tisActive: Boolean\n\t\t\tisDeleted: Boolean\n\t\t): Paginate<Assessment> @auth(scope:"assessments:read")\n\t}\n\n\textend type Mutation {\n\t\tinsertAssessments(\n\t\t\tassessments: [AssessmentInput]\n\t\t): Boolean @auth(scope:"assessments:write")\n\n\t\tinsertOneAssessment(\n\t\t\thousingCooperativeId: ID!\n\t\t\tcategoryId: ID\n\t\t\tname: String\n\t\t\tobjectType: String\n\t\t\tlifespan: [String]\n\t\t\tstateLevel: String\n\t\t\tdescription: String\n\t\t\tmeasure: String\n\t\t\taddress: ID\n\t\t\tcost: String\n\t\t\tproductionYear: String\n\t\t\tlastMaintained: String\n\t\t\tunitAmount: String\n\t\t\tdimensions: String\n\t\t\tgroupKey: Int\n\t\t\tgroupOrder: Int\n\t\t\tcategory: String\n\t\t\tdueDate: DateTime\n\t\t\tisActive: Boolean\n\t\t\tisCompleted: Boolean\n\t\t\tcompletedAt: DateTime\n\t\t): Assessment @auth(scope:"assessments:write")\n\n\t\tupdateOneAssessment(\n\t\t\t_id: ID!\n\t\t\thousingCooperativeId: ID\n\t\t\tname: String\n\t\t\tobjectType: String\n\t\t\tlifespan: [String]\n\t\t\tstateLevel: String\n\t\t\tdescription: String\n\t\t\tmeasure: String\n\t\t\taddress: ID\n\t\t\tcost: String\n\t\t\tproductionYear: String\n\t\t\tlastMaintained: String\n\t\t\tunitAmount: String\n\t\t\tdimensions: String\n\t\t\tgroupKey: Int\n\t\t\tgroupOrder: Int\n\t\t\tcategory: String\n\t\t\tdueDate: DateTime\n\t\t\tcreatedAt: DateTime\n\t\t\tisActive: Boolean\n\t\t\tisCompleted: Boolean\n\t\t\tprimaryImageId: ID\n\t\t): Assessment @auth(scope:"assessments:write")\n\n\t\tdeleteOneAssessment(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"assessments:write")\n\n\t\tmassEditAssessmentCreatedAt(\n\t\t\tids: [ID]!\n\t\t\tcreatedAt: DateTime!\n\t\t): Boolean @auth(scope:"assessments:write")\n\t}\n\t',resolvers:{Assessment:{addressName:function(t,e,n){var r;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.address){e.next=2;break}return e.abrupt("return","Adresse mangler");case 2:return e.next=4,s.a.awrap(n.Addresses.findOne({_id:t.address,housingCooperativeId:t.housingCooperativeId,isDeleted:{$ne:!0}}));case 4:return r=e.sent,e.abrupt("return",r&&r.name||"Adresse mangler");case 6:case"end":return e.stop()}}))}},Query:{findOneAssessment:tt("Assessments"),findAssessments:et("Assessments",{transformQuery:function(t,e,n,r){var s=n.address,a=z()(n,["address"]);return a.isCompleted||(a.isCompleted={$ne:!0}),a.search&&(a.$or=[{name:new RegExp(a.search,"gi")},{objectType:new RegExp(a.search,"gi")}],delete a.$text),s&&(a.address=s),a.search=void 0,a}}),paginateAssessments:nt("Assessments"),findGroupedAssessments:function(t,e,n){var r,a,o,u,c,p,d,l,g,f,m,y,h,S,v,I,b;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.orderBy,o=e.search,u=e.year,c=e.address,p=z()(e,["orderBy","search","year","address"]),d=n.Addresses,l=n.Assessments,g=n.Categories,f=n.Files,t.next=4,s.a.awrap(g.find({isSeparated:!0}).sort({order:1}).toArray());case 4:return m=t.sent,y=[],m.forEach((function(t){return y.push(t.name)})),p.isCompleted||(p.isCompleted={$ne:!0}),p.isDeleted||(p.isDeleted={$ne:!0}),p.stateLevel&&p.stateLevel.length&&(h=[],p.stateLevel.includes("tgiu")&&h.push("tgiu"),p.stateLevel.includes("tg0")&&h.push("tg0"),p.stateLevel.includes("tg1")&&h.push.apply(h,["tg0tg1","tg1"]),p.stateLevel.includes("tg2")&&h.push.apply(h,["tg0tg2","tg1tg2","tg2"]),p.stateLevel.includes("tg3")&&h.push.apply(h,["tg0tg3","tg1tg3","tg2tg3","tg3"]),p.stateLevel={$in:h}),c&&(p.address=c),o&&(p.$or=[{name:new RegExp(o,"gi")},{objectType:new RegExp(o,"gi")}]),t.next=14,s.a.awrap(l.find(p).sort((r={},i()(r,a,1),i()(r,"name",1),r)).toArray());case 14:return S=t.sent,t.next=17,s.a.awrap(Promise.all(S.map((function(t,e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t.index=e,t.address||(t.addressName="Adresse mangler"),r.next=4,s.a.awrap(d.findOne({_id:t.address,housingCooperativeId:t.housingCooperativeId,isDeleted:{$ne:!0}}));case 4:return n=r.sent,t.addressName=n&&n.name||"Adresse mangler",r.abrupt("return",t);case 7:case"end":return r.stop()}}))}))));case 17:return v={},t.next=20,s.a.awrap(Promise.all(S.map((function(t,e){var r,a;return s.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(t.index=e,!u||n.moment(t.dueDate).isBetween("".concat(u-1,"-12-30"),"".concat(u,"-12-30"))){o.next=3;break}return o.abrupt("return",!1);case 3:return r=t.category||t.objectType,a=t.addressName,v.hasOwnProperty(a)||(v[a]={subGroups:i()({},r,{items:[],isSeparated:y.includes(t.category||t.objectType)})}),v[a].subGroups.hasOwnProperty(r)||(v[a].subGroups[r]={items:[],isSeparated:y.includes(t.category||t.objectType)}),o.next=9,s.a.awrap(f.find({docId:t._id,isDeleted:{$ne:!0}}).toArray());case 9:t.files=o.sent,v[a].subGroups[r].items.splice(t.index,0,t);case 11:case"end":return o.stop()}}))}))));case 20:return I={},Object.keys(v).sort().forEach((function(t){I[t]=v[t]})),v=I,b=[],Object.keys(v).forEach((function(t){var e=v[t],n={title:t,subGroups:[]};Object.keys(e.subGroups).forEach((function(t){var r=e.subGroups[t];r.title=t,n.subGroups.push(r)})),b.push(n)})),t.abrupt("return",b);case 26:case"end":return t.stop()}}))}},Mutation:{insertOneAssessment:W("Assessments"),updateOneAssessment:Z("Assessments",{transformDoc:function(t,e,n,r){var a,i,o,u,c,p,d,l,g;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.uuid,i=r.user,o=r.Assessments,u=r.Activities,c=e._id,t.next=4,s.a.awrap(o.findOne({_id:c}));case 4:if(p=t.sent,!0!==n.isCompleted){t.next=12;break}return n.completedAt=new Date,d={_id:a(),isFreshDuplicate:!0,createdBy:i._id,createdAt:parseInt((new Date).getTime()),housingCooperativeId:p.housingCooperativeId,address:p.address||"",categoryId:p.categoryId||"",name:p.name||"",objectType:p.objectType||"",category:p.category||"",productionYear:p.productionYear||"",stateLevel:"tgiu",isCompleted:!1},t.next=10,s.a.awrap(o.insertOne(d));case 10:t.next=14;break;case 12:n.completedAt=null,n.isCompleted=!1;case 14:if(n.createdAt&&(n.groupKey=at()(n.createdAt).format("YYYYMM")),n.isFreshDuplicate=!1,l=!1,i.roles.forEach((function(t){"*"===t.housingCooperativeId&&"admin"===t.role&&(l=!0)})),!l){t.next=20;break}return t.abrupt("return",n);case 20:return t.next=22,s.a.awrap(ct(ut({},p,{},n),p));case 22:if(!((g=t.sent).length>0)){t.next=26;break}return t.next=26,s.a.awrap(u.insertOne({_id:a(),createdBy:i._id,createdAt:new Date,userName:i.name,assessmentId:c,type:"change",diff:g}));case 26:return t.abrupt("return",n);case 27:case"end":return t.stop()}}))}}),deleteOneAssessment:X("Assessments"),insertAssessments:function(t,e,n){var r,a;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.Assessments,a=[],e.assessments.map((function(t){var e=n.uuid(),s=n.user._id,i=parseInt((new Date).getTime()),o=r.insertOne(ut({_id:e,createdBy:s,createdAt:i},t));a.push(o)})),t.abrupt("return",!0);case 4:case"end":return t.stop()}}))},massEditAssessmentCreatedAt:function(t,e,n){var r,a;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.Assessments,t.next=3,s.a.awrap(Promise.all(e.ids.map((function(t,a){return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=s.a,i.t1=r,i.t2={_id:t},i.next=5,s.a.awrap(n.moment(e.createdAt).add(a,"ms").toISOString(!0));case 5:return i.t3=i.sent,i.t4={createdAt:i.t3},i.t5={$set:i.t4},i.t6=i.t1.updateOne.call(i.t1,i.t2,i.t5),i.next=11,i.t0.awrap.call(i.t0,i.t6);case 11:return i.abrupt("return",i.sent);case 12:case"end":return i.stop()}}))}))));case 3:return a=t.sent,t.abrupt("return",!!a);case 5:case"end":return t.stop()}}))}}}},dt={typeDefs:'\n\ttype BuildingData inherits Document {\n\t\taddress: String\n\t\tcategory: String\n\t\tobject: String\n\t\tamount: String\n\t\thousingCooperativeId: ID\n\t}\n\n\textend type Query {\n\t\tfindOneBuildingData(\n\t\t\t_id: ID!\n\t\t): BuildingData @auth(scope:"buildingData:read")\n\n\t\tfindBuildingData(\n\t\t\t_id: ID\n\t\t\thousingCooperativeId: ID!\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<BuildingData> @auth(scope:"buildingData:read")\n\n\t\tpaginateBuildingData(\n\t\t\thousingCooperativeId: ID!\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<BuildingData> @auth(scope:"buildingData:read")\n\t}\n\n\textend type Mutation {\n\t\tinsertOneBuildingData(\n\t\t\thousingCooperativeId: ID!\n\t\t\taddress: String\n\t\t\tcategory: String\n\t\t\tobject: String\n\t\t\tamount: String\n\t\t): BuildingData @auth(scope:"buildingData:write")\n\n\t\tupdateOneBuildingData(\n\t\t\t_id: ID!\n\t\t\thousingCooperativeId: ID!\n\t\t\taddress: String\n\t\t\tcategory: String\n\t\t\tobject: String\n\t\t\tamount: String\n\t\t): BuildingData @auth(scope:"buildingData:write")\n\n\t\tdeleteOneBuildingData(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"buildingData:write")\n\t}\n\t',resolvers:{Query:{findOneBuildingData:tt("BuildingData"),findBuildingData:et("BuildingData"),paginateBuildingData:nt("BuildingData")},Mutation:{insertOneBuildingData:W("BuildingData"),updateOneBuildingData:Z("BuildingData"),deleteOneBuildingData:X("BuildingData")}}},lt={typeDefs:'\n\ttype CategoryChild {\n\t\tname: String\n\t\ttype: String\n\t\torder: Int\n\t\torderIndex: Int\n\t\tisSeparated: Boolean\n\t}\n\ttype Category inherits Document {\n\t\tname: String\n\t\ttype: String\n\t\tparentId: ID\n\t\torder: Int\n\t\torderIndex: Int\n\t\tisSeparated: Boolean\n\t\tchildren: [CategoryChild]\n\t\tlifeSpans: [CategoryChild]\n\t}\n\n\tinput CategoryChildInput {\n\t\tname: String\n\t\ttype: String\n\t\torder: Int\n\t\torderIndex: Int\n\t\tisSeparated: Boolean\n\t}\n\n\textend type Query {\n\t\tfindOneCategory(\n\t\t\t_id: ID\n\t\t): Category @auth(scope:"categories:read")\n\n\t\tfindCategories(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t\tparentId: ID\n\t\t): Find<Category> @auth(scope:"categories:read")\n\n\t\tpaginateCategories(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<Category> @auth(scope:"categories:read")\n\n\t}\n\textend type Mutation {\n\t\tinsertOneCategory(\n\t\t\tname: String\n\t\t\ttype: String\n\t\t\tparentId: ID\n\t\t\torder: Int\n\t\t\torderIndex: Int\n\t\t\tisSeparated: Boolean\n\t\t\tchildren: [CategoryChildInput]\n\t\t\tlifeSpans: [CategoryChildInput]\n\t\t): Category @auth(scope:"categories:write")\n\n\t\tupdateOneCategory(\n\t\t\t_id: ID!\n\t\t\tname: String\n\t\t\ttype: String\n\t\t\tparentId: ID\n\t\t\torder: Int\n\t\t\torderIndex: Int\n\t\t\tisSeparated: Boolean\n\t\t\tchildren: [CategoryChildInput]\n\t\t\tlifeSpans: [CategoryChildInput]\n\t\t): Category @auth(scope:"categories:write")\n\n\t\tdeleteOneCategory(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"categories:write")\n\t}\n\t',resolvers:{Query:{findOneCategory:tt("Categories"),findCategories:et("Categories"),paginateCategories:nt("Categories")},Mutation:{insertOneCategory:W("Categories"),updateOneCategory:Z("Categories"),deleteOneCategory:X("Categories")}}},gt={typeDefs:'\n\ttype File inherits Document {\n\t\tfileType: String\n\t\tfileName: String\n\t\tfileUrl: String\n\t\tdocId: ID\n\t\tpage: String\n\t\thousingCooperativeId: ID\n\t}\n\n\textend type Query {\n\t\tfindOneFile(\n\t\t\t_id: ID!\n\t\t): File @auth(scope:"files:read")\n\n\t\tfindFiles(\n\t\t\tdocId: ID\n\t\t\thousingCooperativeId: ID\n\t\t\tpage: String\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<File> @auth(scope:"files:read")\n\n\t\tpaginateFiles(\n\t\t\tdocId: ID\n\t\t\thousingCooperativeId: ID\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<File> @auth(scope:"files:read")\n\t}\n\t\n\textend type Mutation {\n\t\tinsertOneFile(\n\t\t\tdocId: ID\n\t\t\tpage: String\n\t\t\thousingCooperativeId: ID\n\t\t\tfileType: String\n\t\t\tfileName: String\n\t\t\tfileUrl: String\n\t\t): File @auth(scope:"files:write")\n\n\t\tupdateOneFile(\n\t\t\t_id: ID!\n\t\t\tdocId: ID\n\t\t\tfileType: String\n\t\t\tfileName: String\n\t\t\tfileUrl: String\n\t\t\tpage: String\n\t\t\thousingCooperativeId: ID\n\t\t\tisDeleted: Boolean\n\t\t): File @auth(scope:"files:write")\n\t\t\n\t\tdeleteOneFile(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"files:write")\n\t\t\n\t\tgetUploadUrl(\n\t\t\tkey: String!\n\t\t\tfileContentType: String!\n\t\t): String @auth(scope:"files:write")\n\t}\n\t',resolvers:{Query:{findOneFile:tt("Files"),findFiles:et("Files"),paginateFiles:nt("Files")},Mutation:{insertOneFile:W("Files"),updateOneFile:Z("Files"),deleteOneFile:X("Files"),getUploadUrl:function(t,e,n){var r,a,i;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.S3,a=e.key,i=e.fileContentType,t.next=4,s.a.awrap(new Promise((function(t,e){r.getSignedUrl("putObject",{Bucket:process.env.AWS_S3_BUCKET,Key:a,ContentType:i,Expires:600},(function(n,r){if(n)return e(n);t(r)}))})));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}))}}}},ft={typeDefs:'\n\ttype HelpVideo inherits Document {\n\t\tisMainVideo: Boolean\n\t\tforEditor: Boolean\n\t\ttitle: String\n\t\torder: Int\n\t\tembedCode: String\n\t}\n\n\textend type Query {\n\t\tfindOneHelpVideo(\n\t\t\t_id: ID!\n\t\t): HelpVideo @auth(scope:"helpVideos:read")\n\n\t\tfindHelpVideos(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<HelpVideo> @auth(scope:"helpVideos:read")\n\n\t\tpaginateHelpVideos(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<HelpVideo> @auth(scope:"helpVideos:read")\n\t}\n\n\textend type Mutation {\n\t\tinsertOneHelpVideo(\n\t\t\tisMainVideo: Boolean\n\t\t\tforEditor: Boolean\n\t\t\ttitle: String\n\t\t\torder: Int\n\t\t\tembedCode: String\n\t\t): HelpVideo @auth(scope:"helpVideos:write")\n\n\t\tupdateOneHelpVideo(\n\t\t\t_id: ID!\n\t\t\tisMainVideo: Boolean\n\t\t\tforEditor: Boolean\n\t\t\ttitle: String\n\t\t\torder: Int\n\t\t\tembedCode: String\n\t\t): HelpVideo @auth(scope:"helpVideos:write")\n\n\t\tdeleteOneHelpVideo(_id: ID!): Boolean @auth(scope:"helpVideos:write")\n\t}\n\t',resolvers:{Query:{findOneHelpVideo:tt("HelpVideos"),findHelpVideos:et("HelpVideos"),paginateHelpVideos:nt("HelpVideos")},Mutation:{insertOneHelpVideo:W("HelpVideos"),updateOneHelpVideo:Z("HelpVideos"),deleteOneHelpVideo:X("HelpVideos")}}},mt={typeDefs:'\n\ttype HousingCooperative inherits Document {\n\t\ttitle: String\n\t\tdepartment: String\n\t\taddress: String\n\t\tpostalNumber: String\n\t\tpostalCity: String\n\t\tmobile: String\n\t\tphone: String\n\t\temail: String\n\t\thasEmployees: Boolean\n\t\tcaretakersCount: Int\n\t\textraHelpCount: Int\n\t\tothersCount: Int\n\t\tcleanersCount: Int\n\t\townersCount: Int\n\t\tshowInMaintenance: Boolean\n\t}\n\n\textend type Query {\n\t\tfindOneHousingCooperative(\n\t\t\t_id: ID!\n\t\t): HousingCooperative @auth(scope:"housingCooperatives:read")\n\n\t\tfindHousingCooperatives(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<HousingCooperative> @auth(scope:"housingCooperatives:read")\n\n\t\tpaginateHousingCooperatives(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<HousingCooperative> @auth(scope:"housingCooperatives:read")\n\t}\n\textend type Mutation {\n\t\tinsertOneHousingCooperative(\n\t\t\ttitle: String\n\t\t\tdepartment: String\n\t\t\taddress: String\n\t\t\tpostalNumber: String\n\t\t\tpostalCity: String\n\t\t\tmobile: String\n\t\t\tphone: String\n\t\t\temail: String\n\t\t\thasEmployees: Boolean\n\t\t\tcaretakersCount: Int\n\t\t\textraHelpCount: Int\n\t\t\tothersCount: Int\n\t\t\tcleanersCount: Int\n\t\t\tshowInMaintenance: Boolean\n\t\t): HousingCooperative @auth(scope:"housingCooperatives:write")\n\n\t\tupdateOneHousingCooperative(\n\t\t\t_id: ID!\n\t\t\ttitle: String\n\t\t\tdepartment: String\n\t\t\taddress: String\n\t\t\tpostalNumber: String\n\t\t\tpostalCity: String\n\t\t\tmobile: String\n\t\t\tphone: String\n\t\t\temail: String\n\t\t\thasEmployees: Boolean\n\t\t\tcaretakersCount: Int\n\t\t\textraHelpCount: Int\n\t\t\tothersCount: Int\n\t\t\tcleanersCount: Int\n\t\t\tshowInMaintenance: Boolean\n\t\t): HousingCooperative @auth(scope:"housingCooperatives:write")\n\n\t\tdeleteOneHousingCooperative(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"housingCooperatives:write")\n\t}\n\t',resolvers:{Query:{findOneHousingCooperative:tt("HousingCooperatives"),findHousingCooperatives:et("HousingCooperatives",{transformQuery:function(t,e,n,r){var a,i;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.search,(i=z()(n,["search"])).showInMaintenance=!0,i.isDeleted||(i.isDeleted={$ne:!0}),a&&(i.$or=[{name:new RegExp(a,"gi")},{objectType:new RegExp(a,"gi")},{address:new RegExp(a,"gi")}],delete i.$text),t.abrupt("return",i);case 5:case"end":return t.stop()}}))}}),paginateHousingCooperatives:nt("HousingCooperatives",{transformQuery:function(t,e,n,r){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return n.showInMaintenance=!0,t.abrupt("return",n);case 2:case"end":return t.stop()}}))}})},Mutation:{insertOneHousingCooperative:W("HousingCooperatives"),updateOneHousingCooperative:Z("HousingCooperatives"),deleteOneHousingCooperative:X("HousingCooperatives")}}},yt=n(9),ht=n.n(yt);function St(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function vt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?St(n,!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):St(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var It=process.env.AUTH0_M2M_CLIENT_ID,bt=process.env.AUTH0_M2M_CLIENT_SECRET,wt=process.env.AUTH0_M2M_AUDIENCE,xt=process.env.AUTH0_CONNECTION,Dt=process.env.AUTH0_TENANT,Ot=function(){function t(){M()(this,t)}return E()(t,null,[{key:"getApiToken",value:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){try{var n={method:"POST",url:"".concat(Dt,"/oauth/token"),headers:{"content-type":"application/json"},body:JSON.stringify({client_id:It,client_secret:bt,audience:wt,grant_type:"client_credentials"})};ht()(n,(function(e,n,r){if(e)throw new Error(e);t(JSON.parse(r))}))}catch(t){e(t)}})));case 1:case"end":return t.stop()}}))}},{key:"createAuth0LoginAccount",value:function(t,e,n){return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,s){try{var a={method:"GET",url:"".concat(Dt,"/api/v2/users-by-email"),qs:{email:e},headers:{"content-type":"application/json",authorization:"Bearer "+t}};ht()(a,(function(t,e,n){t&&s(t);var a=JSON.parse(n);a&&1===a.length&&a[0].user_id&&r(a[0])}))}catch(t){console.log(t),s(t)}try{var i={method:"POST",url:"".concat(Dt,"/api/v2/users"),headers:{"content-type":"application/json",authorization:"Bearer "+t},body:JSON.stringify({email:e,connection:xt,password:n,verify_email:!1})};ht()(i,(function(t,e,n){t&&s(t),r(JSON.parse(n))}))}catch(t){console.log(t),s(t)}})));case 1:case"end":return r.stop()}}))}},{key:"createUser",value:function(){var t=this;return function(e,n,r){var a,i,o,u,c,p;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.auth0Id){e.next=2;break}throw new Error("User already has auth0Id");case 2:return e.prev=2,a=r.uuid(),e.next=6,s.a.awrap(t.getApiToken());case 6:for(i=e.sent,o=i.access_token,n.createdAt=new Date,n.isDeleted=!1,n.password="#","u0YD64Tmr!IKsdgbubQrKM7R*00eP5k^XFauiJySmae@!2hB$k#p$eGFgTmUSZasyn9xLnUeF4NMwulZq#MJv0ziQ337T$W%!T$",u=0;u<20;u++)n.password+="u0YD64Tmr!IKsdgbubQrKM7R*00eP5k^XFauiJySmae@!2hB$k#p$eGFgTmUSZasyn9xLnUeF4NMwulZq#MJv0ziQ337T$W%!T$"[Math.floor(100*Math.random())];return e.next=15,s.a.awrap(t.createAuth0LoginAccount(o,n.email,n.password));case 15:return c=e.sent,n.auth0Id=c.user_id,delete n.password,e.next=20,s.a.awrap(r.Users.insertOne(vt({_id:a},n)));case 20:return p=e.sent,e.abrupt("return",p.ops[0]);case 24:throw e.prev=24,e.t0=e.catch(2),new Error(e.t0);case 27:case"end":return e.stop()}}),null,null,[[2,24]])}}},{key:"deleteUser",value:function(){return function(t,e,n){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s.a.awrap(n.Users.deleteOne(e));case 3:return t.abrupt("return",!0);case 6:throw t.prev=6,t.t0=t.catch(0),new Error(t.t0);case 9:case"end":return t.stop()}}),null,null,[[0,6]])}}},{key:"migrateUser",value:function(){var t=this;return function(e,n,r){var a,i,o,u,c,p,d;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,"u0YD64Tmr!IKsdgbubQrKM7R*00eP5k^XFauiJySmae@!2hB$k#p$eGFgTmUSZasyn9xLnUeF4NMwulZq#MJv0ziQ337T$W%!T$",a="#1",i=0;i<20;i++)a+="u0YD64Tmr!IKsdgbubQrKM7R*00eP5k^XFauiJySmae@!2hB$k#p$eGFgTmUSZasyn9xLnUeF4NMwulZq#MJv0ziQ337T$W%!T$"[Math.floor(100*Math.random())];return o=r.Users,e.next=7,s.a.awrap(t.getApiToken());case 7:return u=e.sent,c=u.access_token,e.next=11,s.a.awrap(o.findOne({_id:n._id}));case 11:if(!(p=e.sent).auth0Id){e.next=14;break}throw new Error("User already migrated to new login.");case 14:return e.next=16,s.a.awrap(t.createAuth0LoginAccount(c,p.email,a));case 16:return d=e.sent,e.next=19,s.a.awrap(o.updateOne({_id:n._id},{$set:{auth0Id:d.user_id}}));case 19:return e.abrupt("return",!0);case 22:throw e.prev=22,e.t0=e.catch(0),new Error(e.t0);case 25:case"end":return e.stop()}}),null,null,[[0,22]])}}}]),t}(),At={typeDefs:'\n\ttype Role {\n\t\thousingCooperativeId: String!\n\t\trole: String!\n\t}\n\n\tinput RoleInput {\n\t\thousingCooperativeId: String!\n\t\trole: String!\n\t}\n\n\ttype User inherits Document {\n\t\tusername: String\n\t\temail: String!\n\t\tauth0Id: ID\n\t\tname: String\n\t\taddress: String\n\t\tpostalNumber: String\n\t\tpostalCity: String\n\t\tphone: String\n\t\tposition: String\n\t\tnotifyPhone: Boolean\n\t\tnotifyEmail: Boolean\n\t\troles: [Role]\n\t}\n\n\textend type Query {\n\t\tfindOneUser(\n\t\t\t_id: ID\n\t\t\tauth0Id: ID\n\t\t): User @auth(scope:"user:read")\n\n\t\tfindOneUserRaw(\n\t\t\tauth0Id: ID!\n\t\t): User\n\n\t\tfindUsers(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t\tcurrentHousingCooperativeId: ID\n\t\t): Find<User> @auth(scope:"user:read")\n\n\t\tpaginateUsers(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Paginate<User>\n\t}\n\n\textend type Mutation {\n\t\tinsertOneUser(\n\t\t\tauth0Id: ID\n\t\t\tpassword: String\n\t\t\tusername: String\n\t\t\temail: String!\n\t\t\tname: String\n\t\t\taddress: String\n\t\t\tpostalNumber: String\n\t\t\tpostalCity: String\n\t\t\tphone: String\n\t\t\tposition: String\n\t\t\troles: [RoleInput]\n\t\t\tclaims: [String]\n\t\t): User @auth(scope:"user:write")\n\n\t\tupdateOneUser(\n\t\t\t_id: ID!\n\t\t\tusername: String\n\t\t\temail: String\n\t\t\tname: String\n\t\t\taddress: String\n\t\t\tpostalNumber: String\n\t\t\tpostalCity: String\n\t\t\tphone: String\n\t\t\tposition: String\n\t\t\tauth0Id: ID\n\t\t\troles: [RoleInput]\n\t\t\tclaims: [String]\n\t\t\tisDeleted: Boolean\n\t\t): User @auth(scope:"user:write")\n\n\t\tdeleteOneUser(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"user:write")\n\n\t\tmigrateUser(\n\t\t\t_id: ID!\n\t\t): Boolean\n\t}\n\t',resolvers:{Query:{findOneUser:tt("Users"),findOneUserRaw:tt("Users"),findUsers:et("Users",{transformQuery:function(t,e,n,r){var a,i,o;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.search,i=n.currentHousingCooperativeId,(o=z()(n,["search","currentHousingCooperativeId"])).isDeleted||(o.isDeleted={$ne:!0}),a&&(o.$or=[{name:new RegExp(a,"gi")},{username:new RegExp(a,"gi")},{email:new RegExp(a,"gi")}],delete o.$text),i&&(o.roles={$elemMatch:{housingCooperativeId:{$in:["*",i]}}}),t.abrupt("return",o);case 5:case"end":return t.stop()}}))}}),paginateUsers:nt("Users")},Mutation:{insertOneUser:Ot.createUser(),updateOneUser:Z("Users"),deleteOneUser:Ot.deleteUser(),migrateUser:Ot.migrateUser()}}},Ct={typeDefs:'\n\t\ttype SinglePage inherits Document {\n\t\t\thousingCooperativeId: ID\n\t\t\tname: String\n\t\t\tcontent: String\n\t\t\tcontentTwo: String\n\t\t\tpolicyId: String\n\t\t\thousingcooperative: String,\n\t\t\tunits: String,\n\t\t\tplotNumberOne: String,\n\t\t\tplotNumberTwo: String,\n\t\t\taddress: String,\n\t\t\tzipCode: String,\n\t\t\tbuildYear: String,\n\t\t\tbuildMaterials: String\n\t\t}\n\n\t\textend type Query {\n\t\t\tfindOneSinglePage(\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t\tname: String!\n\t\t\t): SinglePage @auth(scope:"singlePages:read")\n\t\t}\n\n\t\textend type Mutation {\n\t\t\tinsertOneSinglePage(\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t\tname: String!\n\t\t\t\tcontent: String\n\t\t\t\tcontentTwo: String\n\t\t\t\tpolicyId: String\n\t\t\t\thousingcooperative: String,\n\t\t\t\tunits: String,\n\t\t\t\tplotNumberOne: String,\n\t\t\t\tplotNumberTwo: String,\n\t\t\t\taddress: String,\n\t\t\t\tzipCode: String,\n\t\t\t\tbuildYear: String,\n\t\t\t\tbuildMaterials: String\n\t\t\t): SinglePage @auth(scope:"singlePages:write")\n\n\t\t\tupdateOneSinglePage(\n\t\t\t\t_id: ID!\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t\tname: String!\n\t\t\t\tcontent: String\n\t\t\t\tcontentTwo: String\n\t\t\t\tpolicyId: String\n\t\t\t\thousingcooperative: String,\n\t\t\t\tunits: String,\n\t\t\t\tplotNumberOne: String,\n\t\t\t\tplotNumberTwo: String,\n\t\t\t\taddress: String,\n\t\t\t\tzipCode: String,\n\t\t\t\tbuildYear: String,\n\t\t\t\tbuildMaterials: String\n\t\t\t): SinglePage @auth(scope:"singlePages:write")\n\t\t}\n\t',resolvers:{Query:{findOneSinglePage:tt("SinglePages")},Mutation:{insertOneSinglePage:W("SinglePages"),updateOneSinglePage:Z("SinglePages")}}},_t={typeDefs:'\n\t\ttype GeneralInfo inherits Document {\n\t\t\thousingCooperativeId: ID!\n\t\t\thousingcooperative: String\n\t\t\tname: String!\n\t\t\tpolicyId: String\n\t\t\tunits: String\n\t\t\tplotNumberOne: String\n\t\t\tplotNumberTwo: String\n\t\t\taddress: String\n\t\t\tzipCode: String\n\t\t\tbuildYear: String\n\t\t\tbuildMaterials: String\n\t\t\tconclusionContent: String\n\t\t\tgeneralContent: String\n\t\t\tcostContent: String\n\t\t\tplotSize: String\n\t\t\tplotSizeBTA: String\n\t\t\tapartmentUnits: String\n\t\t\tinspectionDate: String\n\t\t\tresponsible: String\n\t\t}\n\n\t\textend type Query {\n\t\t\tfindGeneralInfo(\n\t\t\t\t_id: ID\n\t\t\t\tname: String!\n\t\t\t\thousingCooperativeId: ID\n\t\t\t\tpolicyId: String\n\t\t\t): GeneralInfo @auth(scope:"generalInfo:read")\n\t\t}\n\n\t\textend type Mutation {\n\t\t\tinsertGeneralInfo (\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t\thousingcooperative: String\n\t\t\t\tname: String!\n\t\t\t\tpolicyId: String\n\t\t\t\tunits: String\n\t\t\t\tplotNumberOne: String\n\t\t\t\tplotNumberTwo: String\n\t\t\t\taddress: String\n\t\t\t\tzipCode: String\n\t\t\t\tbuildYear: String\n\t\t\t\tbuildMaterials: String\n\t\t\t\tconclusionContent: String\n\t\t\t\tgeneralContent: String\n\t\t\t\tcostContent: String\n\t\t\t\tplotSize: String\n\t\t\t\tplotSizeBTA: String\n\t\t\t\tapartmentUnits: String\n\t\t\t\tinspectionDate: String\n\t\t\t\tresponsible: String\n\t\t\t): GeneralInfo @auth(scope:"generalInfo:write")\n\n\t\t\tupdateGeneralInfo (\n\t\t\t\t_id: ID!\n\t\t\t\thousingCooperativeId: ID\n\t\t\t\thousingcooperative: String\n\t\t\t\tname: String!\n\t\t\t\tpolicyId: String\n\t\t\t\tunits: String\n\t\t\t\tplotNumberOne: String\n\t\t\t\tplotNumberTwo: String\n\t\t\t\taddress: String\n\t\t\t\tzipCode: String\n\t\t\t\tbuildYear: String\n\t\t\t\tbuildMaterials: String\n\t\t\t\tconclusionContent: String\n\t\t\t\tgeneralContent: String\n\t\t\t\tcostContent: String\n\t\t\t\tplotSize: String\n\t\t\t\tplotSizeBTA: String\n\t\t\t\tapartmentUnits: String\n\t\t\t\tinspectionDate: String\n\t\t\t\tresponsible: String\n\t\t\t): GeneralInfo @auth(scope:"generalInfo:write")\n\t\t}\n\t',resolvers:{Query:{findGeneralInfo:tt("SinglePages")},Mutation:{insertGeneralInfo:W("SinglePages"),updateGeneralInfo:Z("SinglePages")}}},kt=n(12),Bt=n.n(kt),Pt=n(5),Tt=n.n(Pt),jt=n(29),Mt=n.n(jt);function Ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ut(n,!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ut(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Nt=function(t){var e,n,r;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(t.Users.find({profile:{$exists:!0}}).toArray());case 2:if((e=a.sent).length){a.next=5;break}return a.abrupt("return",!0);case 5:return a.next=7,s.a.awrap(Ot.getApiToken());case 7:n=a.sent,r=n.access_token,e.map((function(e){var n,a,i,o,u,c,p;return s.a.async((function(d){for(;;)switch(d.prev=d.next){case 0:for(n=[],Object.keys(e.roles).map((function(t){n.push({housingCooperativeId:"__global_roles__"===t?"*":t,role:e.roles[t]&&e.roles[t][0]&&"superAdmin"===e.roles[t][0]?"admin":e.roles[t][0]?e.roles[t][0]:"contact"})})),a="#",i=0;i<20;i++)a+="u0YD64Tmr!IKsdgbubQrKM7R*00eP5k^XFauiJySmae@!2hB$k#p$eGFgTmUSZasyn9xLnUeF4NMwulZq#MJv0ziQ337T$W%!T$"[Math.floor(100*Math.random())];if(o="",e.createdAt&&(o=e.createdAt),e.username||!e.emails||!e.emails.length){d.next=20;break}if(!e.emails[0]||!e.emails[0].address){d.next=11;break}e.username=e.emails[0].address,d.next=18;break;case 11:return e.username=e._id+"-missingUsername",e.email=e.emails&&e.emails.length&&e.emails[0].address?e.emails[0].address:e._id+"@missingemail.com",e.isDeleted=!0,e.notMigrated=!0,d.next=17,s.a.awrap(t.Users.replaceOne({_id:e._id},u));case 17:return d.abrupt("return",!0);case 18:d.next=21;break;case 20:e.username=e._id+"-missingUsername";case 21:if((u={username:e.username,email:e.emails&&e.emails.length&&e.emails[0].address?e.emails[0].address:e._id+"@missingemail.com",name:e.profile?e.profile.name:"Mangler Navn",address:e.profile?e.profile.address:"",postalNumber:e.profile?e.profile.postalNumber:"",phone:e.profile?e.profile.phone:"",position:e.profile?e.profile.position:"",notifyPhone:e.profile?e.profile.notifyPhone:void 0,notifyEmail:e.profile?e.profile.notifyEmail:void 0,roles:n,createdAt:o}).email===e._id+"@missingemail.com"){d.next=28;break}return d.next=25,s.a.awrap(Ot.createAuth0LoginAccount(r,u.email,a));case 25:c=d.sent,p=c.user_id,u.auth0Id=p;case 28:return d.next=30,s.a.awrap(t.Users.replaceOne({_id:e._id},u));case 30:return d.abrupt("return",!0);case 31:case"end":return d.stop()}}))}));case 10:case"end":return a.stop()}}))},$t=function(t){var e,n,r;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(t.SinglePages.find({"content.blocks":{$exists:!0}}).toArray());case 2:return(e=a.sent).length&&e.map((function(e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Et,r.t1={},r.t2=e,r.next=5,s.a.awrap(Tt()(e.content));case 5:if(r.t3=r.sent,r.t4={content:r.t3},n=(0,r.t0)(r.t1,r.t2,r.t4),!e.contentTwo||!e.contentTwo.blocks){r.next=12;break}return r.next=11,s.a.awrap(Tt()(e.contentTwo));case 11:n.contentTwo=r.sent;case 12:t.SinglePages.replaceOne({_id:e._id},n);case 13:case"end":return r.stop()}}))})),a.next=6,s.a.awrap(t.SinglePages.find({"contentTwo.blocks":{$exists:!0}}).toArray());case 6:return(n=a.sent).length&&n.map((function(e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Et,r.t1={},r.t2=e,r.next=5,s.a.awrap(Tt()(e.content));case 5:if(r.t3=r.sent,r.t4={content:r.t3},n=(0,r.t0)(r.t1,r.t2,r.t4),!e.contentTwo){r.next=12;break}return r.next=11,s.a.awrap(Tt()(e.contentTwo));case 11:n.contentTwo=r.sent;case 12:t.SinglePages.replaceOne({_id:e._id},n);case 13:case"end":return r.stop()}}))})),a.next=10,s.a.awrap(t.SinglePages.find({"content.policyId":{$exists:!0}}).toArray());case 10:if((r=a.sent).length){a.next=13;break}return a.abrupt("return",!0);case 13:return r.map((function(e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:delete(n=Et({},e,{},e.content)).content,t.SinglePages.replaceOne({_id:e._id},n);case 3:case"end":return r.stop()}}))})),a.abrupt("return",!0);case 15:case"end":return a.stop()}}))},Ft=function(t){var e;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("migrating activities"),n.next=3,s.a.awrap(t.Activities.find({type:"change",isMigrated:{$ne:!0}}).toArray());case 3:if(0!==(e=n.sent).length){n.next=6;break}return n.abrupt("return",!0);case 6:return n.next=8,s.a.awrap(Promise.all(e.map((function(e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return(n=Et({},e)).diff=[],n.isMigrated=!0,e.diff&&Object.keys(e.diff).length&&Object.keys(e.diff).forEach((function(t){n.diff.push({from:"object"===Bt()(e.diff[t][0])?0:e.diff[t][0],to:"object"===Bt()(e.diff[t][1])?0:e.diff[t][1],key:t})})),r.next=6,s.a.awrap(t.Activities.replaceOne({_id:e._id},n));case 6:r.sent;case 7:case"end":return r.stop()}}))}))));case 8:return n.abrupt("return",!0);case 9:case"end":return n.stop()}}))},Ht=function(t){var e;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(t.BuildingData.find({building:{$exists:!0}}).toArray());case 2:if(0!==(e=n.sent).length){n.next=5;break}return n.abrupt("return",!0);case 5:return e.map((function(e){var n=Et({},e);delete n.building,delete n.count,n.category=e.building,n.amount=e.count;t.BuildingData.replaceOne({_id:e._id},n)})),n.abrupt("return",!0);case 7:case"end":return n.stop()}}))},qt=function(t){var e,n,r,a;return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.awrap(t.Categories.find({parentId:{$exists:!1},isDeleted:{$ne:!0},children:{$exists:!1}}).toArray());case 2:if(0!==(e=i.sent).length){i.next=5;break}return i.abrupt("return",!0);case 5:n=[],r=0;case 7:if(!(r<e.length)){i.next=21;break}return(a=e[r]).children=[],a.lifeSpans=[],i.next=13,s.a.awrap(t.Categories.find({parentId:a._id,isDeleted:{$ne:!0},type:"lifespan"}).toArray());case 13:return a.lifeSpans=i.sent,i.next=16,s.a.awrap(t.Categories.find({parentId:a._id,isDeleted:{$ne:!0},type:{$exists:!1}}).toArray());case 16:a.children=i.sent,n.push(a);case 18:r++,i.next=7;break;case 21:return i.next=23,s.a.awrap(t.Categories.deleteMany({}));case 23:n.map((function(e){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(t.Categories.insertOne(Et({},e)));case 2:case"end":return n.stop()}}))}));case 24:case"end":return i.stop()}}))},Qt=function(t){var e;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(t.Assessments.find({isDeleted:{$ne:!0},categoryId:{$exists:!1}}).toArray());case 2:if(0!==(e=n.sent).length){n.next=5;break}return n.abrupt("return",!0);case 5:return n.next=7,s.a.awrap(e.forEach((function(e){var n,r;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return n={$or:[{name:e.objectType},{"children.name":e.objectType}]},e.lifespan&&e.lifespan.length&&n.$or.push({"lifeSpans.name":e.lifespan[0].name}),e.groupOrder&&n.$or.push({order:e.groupOrder}),a.next=5,s.a.awrap(t.Categories.findOne(n));case 5:if(!(r=a.sent)){a.next=11;break}return e.categoryId=r._id,a.next=10,s.a.awrap(t.Assessments.replaceOne({_id:e._id},e));case 10:a.sent;case 11:case"end":return a.stop()}}))})));case 7:return n.abrupt("return",!0);case 8:case"end":return n.stop()}}))},Lt=function(t){var e,n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.a.awrap(t.Assessments.find({isDeleted:{$ne:!0},isCompleted:{$ne:!0},address:{$exists:!0,$not:{$size:0}}}).toArray());case 2:if(0!==(e=r.sent).length){r.next=5;break}return r.abrupt("return",!0);case 5:return n=[],r.next=8,s.a.awrap(Promise.all(e.map((function(e){var r,a;return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(r=n.find((function(t){return t.name===e.address})),a={_id:"",name:"",housingCooperativeId:""},!r){i.next=6;break}a=r,i.next=10;break;case 6:return a={_id:Mt()(),name:e.address,housingCooperativeId:e.housingCooperativeId},n.push(a),i.next=10,s.a.awrap(t.Addresses.insertOne(Et({},a)));case 10:return i.next=12,s.a.awrap(t.Assessments.updateOne({_id:e._id},{$set:{address:a._id}}));case 12:case"end":return i.stop()}}))}))));case 8:return r.abrupt("return",!0);case 9:case"end":return r.stop()}}))},Rt=function(t){var e;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(t.Assessments.find({isDeleted:{$ne:!0},dueDate:{$exists:!0}}).toArray());case 2:if(0!==(e=n.sent).length){n.next=5;break}return n.abrupt("return",!0);case 5:return n.next=7,s.a.awrap(Promise.all(e.map((function(e){var n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n={},e.createdAt&&(n.createdAt=t.moment(e.createdAt).toDate()),e.dueDate&&(n.dueDate=t.moment(e.dueDate).toDate()),r.next=5,s.a.awrap(t.Assessments.updateOne({_id:e._id},{$set:n}));case 5:case"end":return r.stop()}}))}))));case 7:return n.abrupt("return",!0);case 8:case"end":return n.stop()}}))},Vt={typeDefs:'\n\ttype Setting inherits Document {\n\t\tname: String\n\t\tvalue: String\n\t\tisComplete: Boolean\n\t\tlogoId: ID\n\t\tlogoURL: String\n\t\tsystemName: String\n\t}\n\n\textend type Query {\n\t\tfindOneSetting(\n\t\t\t_id: ID\n\t\t\tname: String\n\t\t): Setting @auth(scope:"settings:read")\n\n\t\tfindSettings(\n\t\t\tskip: Int\n\t\t\tlimit: Int\n\t\t\tsearch: String\n\t\t\torder: Int\n\t\t\torderBy: String\n\t\t): Find<Setting> @auth(scope:"settings:read")\n\t}\n\n\textend type Mutation {\n\t\tinsertOneSetting(\n\t\t\tname: String\n\t\t\tisComplete: Boolean\n\t\t\tvalue: String\n\t\t\tlogoId: ID\n\t\t\tlogoURL: String\n\t\t\tsystemName: String\n\t\t): Setting @auth(scope:"settings:write")\n\t\t\t\n\t\tupdateOneSetting(\n\t\t\t_id: ID!\n\t\t\tname: String\n\t\t\tisComplete: Boolean\n\t\t\tvalue: String\n\t\t\tlogoId: ID\n\t\t\tlogoURL: String\n\t\t\tsystemName: String\n\t\t): Setting @auth(scope:"settings:write")\n\n\t\tdeleteOneSetting(\n\t\t\t_id: ID!\n\t\t): Boolean @auth(scope:"settings:write")\n\n\t\tmigrateData(\n\t\t\tname: String!\n\t\t): Boolean @auth(scope:"settings:write")\n\t}\n\t\t',resolvers:{Query:{findOneSetting:tt("Settings"),findSettings:et("Settings")},Mutation:{insertOneSetting:W("Settings"),updateOneSetting:Z("Settings"),deleteOneSetting:X("Settings"),migrateData:function(t,e,n,r){var a,i,o;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.name){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,s.a.awrap(n.Settings.findOne({name:a}));case 5:if(i=t.sent){t.next=10;break}return i={_id:n.uuid(),createdBy:n.user._id,createdAt:new Date,name:a},t.next=10,s.a.awrap(n.Settings.insertOne(i));case 10:if(!i.isComplete){t.next=12;break}return t.abrupt("return",!1);case 12:o=!1,t.t0=a,t.next="users"===t.t0?16:"singlePages"===t.t0?20:"activities"===t.t0?24:"buildingData"===t.t0?28:"categories"===t.t0?32:"assessments"===t.t0?36:"addresses"===t.t0?40:"assessmentDates"===t.t0?44:48;break;case 16:return t.next=18,s.a.awrap(Nt(n));case 18:return o=!0,t.abrupt("break",49);case 20:return t.next=22,s.a.awrap($t(n));case 22:return o=!0,t.abrupt("break",49);case 24:return t.next=26,s.a.awrap(Ft(n));case 26:return o=!0,t.abrupt("break",49);case 28:return t.next=30,s.a.awrap(Ht(n));case 30:return o=!0,t.abrupt("break",49);case 32:return t.next=34,s.a.awrap(qt(n));case 34:return o=!0,t.abrupt("break",49);case 36:return t.next=38,s.a.awrap(Qt(n));case 38:return o=!0,t.abrupt("break",49);case 40:return t.next=42,s.a.awrap(Lt(n));case 42:return o=!0,t.abrupt("break",49);case 44:return t.next=46,s.a.awrap(Rt(n));case 46:return o=t.sent,t.abrupt("break",49);case 48:return t.abrupt("break",49);case 49:if(!o){t.next=56;break}return i.isComplete=!0,t.next=53,s.a.awrap(n.Settings.replaceOne({_id:i._id},i));case 53:return t.abrupt("return",!0);case 56:return t.abrupt("return",!1);case 57:case"end":return t.stop()}}))}}}},Gt={typeDefs:'\n\t\ttype Address inherits Document {\n\t\t\thousingCooperativeId: ID!\n\t\t\tname: String!\n\t\t}\n\n\t\textend type Query {\n\t\t\tfindOneAddress(\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t\tname: String!\n\t\t\t): Address @auth(scope:"addresses:read")\n\n\t\t\tfindAddressesByHousingCooperativeId(\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t): [Address] @auth(scope:"addresses:read")\n\t\t}\n\n\t\textend type Mutation {\n\t\t\tinsertOneAddress(\n\t\t\t\thousingCooperativeId: ID!\n\t\t\t\tname: String!\n\t\t\t): Address @auth(scope:"addresses:write")\n\n\t\t\tupdateOneAddress(\n\t\t\t\t_id: ID!\n\t\t\t\tname: String!\n\t\t\t): Address @auth(scope:"addresses:write")\n\n\t\t\tduplicateAddress(\n\t\t\t\tfromAddress: ID!\n\t\t\t\ttoAddress: ID!\n\t\t\t): Boolean @auth(scope:"addresses:write")\n\n\t\t\tdeleteOneAddress(\n\t\t\t\t_id: ID!\n\t\t\t): Boolean @auth(scope:"addresses:write")\n\t\t}\n\t',resolvers:{Query:{findOneAddress:tt("Addresses"),findAddressesByHousingCooperativeId:function(t,e,n){var r,a;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.housingCooperativeId,a=n.Addresses,t.next=4,s.a.awrap(a.find({housingCooperativeId:r,isDeleted:{$ne:!0}}).sort({name:1}).toArray());case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}))}},Mutation:{insertOneAddress:W("Addresses"),updateOneAddress:Z("Addresses"),deleteOneAddress:X("Addresses"),duplicateAddress:function(t,e,n){var r,a,i,o,u,c;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.fromAddress,a=e.toAddress,i=z()(e,["fromAddress","toAddress"]),o=n.Assessments,i.isDeleted||(i.isDeleted={$ne:!0}),i.address=r,u={name:1,description:1,measure:1,cost:1,unitAmount:1,dimensions:1,objectType:1,housingCooperativeId:1,lifespan:1,categoryId:1,category:1,groupKey:1,groupOrder:1,isActive:1,isCompleted:1,dueDate:1,productionYear:1,lastMaintained:1},t.next=7,s.a.awrap(o.find(i).project(u).toArray());case 7:if(c=t.sent){t.next=10;break}return t.abrupt("return",!1);case 10:return c.map((function(t){return t.createdAt=new Date,t.isDeleted=!1,t._id=n.uuid(),t.address=a,t.stateLevel="tgiu",n.user&&(t.createdBy=n.user._id,t.createdByDisplayName=n.user.name),t})),t.next=13,s.a.awrap(o.insertMany(c));case 13:return t.abrupt("return",!0);case 14:case"end":return t.stop()}}))}}}},Yt=n(32).graphqls2s.transpileSchema,zt=new _.GraphQLScalarType({name:"DateTime",description:"Resolves to javascript date object",serialize:function(t){return t&&new Date(t)||null},parseValue:function(t){return new Date(t)},parseLiteral:function(t){return new Date(t.value)}}),Jt={Query:{apiVersion:function(t,e,n){return"0.0.1"}},Mutation:{checkTime:function(){return new Date}}},Kt=Object(C.makeExecutableSchema)({typeDefs:Yt("\n\tdirective @auth(scope: String) on OBJECT | FIELD_DEFINITION\n\n\tscalar JSON\n\tscalar DateTime\n\n\ttype Find<T> {\n\t\titems: [T]\n\t\tcount: Int\n\t}\n\n\ttype Paginate<T> {\n\t\titems: [T]\n\t\tcount: Int\n\t}\n\n\ttype Document {\n\t\t_id: ID!\n\t\tcreatedAt: DateTime\n\t\tupdatedAt: DateTime\n\t\tcreatedBy: ID\n\t\tupdatedBy: ID\n\t\tcreatedByDisplayName: String\n\t\tupdatedByDisplayName: String\n\t\tisDeleted: Boolean\n\t}\n\n\ttype Query {\n\t\tapiVersion: String!\n\t}\n\n\ttype Mutation {\n\t\tcheckTime: String!\n\t}\n"+rt.typeDefs+pt.typeDefs+dt.typeDefs+lt.typeDefs+gt.typeDefs+ft.typeDefs+mt.typeDefs+At.typeDefs+Ct.typeDefs+_t.typeDefs+Vt.typeDefs+Gt.typeDefs),resolvers:T()(Jt,rt.resolvers,pt.resolvers,dt.resolvers,lt.resolvers,gt.resolvers,ft.resolvers,mt.resolvers,At.resolvers,Ct.resolvers,_t.resolvers,Vt.resolvers,Gt.resolvers,{JSON:B.a,DateTime:zt}),schemaDirectives:{auth:G}}),Wt=n(30),Zt=n(13),Xt=n.n(Zt);Xt.a.config.update({region:process.env.AWS_REGION});var te=Xt.a,ee=n(33).MongoClient,ne=process.env.MONGODB_URL,re=process.env.SYSTEM_HOUSING_COOPERATIVES_DB_URL||process.env.MONGODB_URL,se=process.env.SYSTEM_IS_MAIN?process.env.MONGODB_URL:process.env.SYSTEM_HELP_VIDEOS_DB_URL,ae=function(t){var e;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(ee.connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0}));case 2:return e=n.sent,n.abrupt("return",e.db());case 4:case"end":return n.stop()}}))},ie=function(){var t,e,n;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.a.awrap(ae(ne));case 2:return t=r.sent,r.next=5,s.a.awrap(ae(re));case 5:return e=r.sent,r.next=8,s.a.awrap(ae(se));case 8:return n=r.sent,r.abrupt("return",{Activities:t.collection("activities"),Assessments:t.collection("assessments"),Addresses:t.collection("addresses"),BuildingData:t.collection("buildingData"),Categories:t.collection("categories"),Files:t.collection("files"),HelpVideos:n.collection("helpVideos"),HousingCooperatives:e.collection("housingCooperatives"),Settings:t.collection("settings"),SinglePages:t.collection("singlePages"),Users:t.collection("users")});case 10:case"end":return r.stop()}}))};function oe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ue(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?oe(n,!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oe(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ce=function(){var t;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(ie());case 2:return t=e.sent,e.abrupt("return",ue({uuid:Wt.v4,S3:new te.S3,moment:at.a,AWS:te},t));case 4:case"end":return e.stop()}}))};function pe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function de(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pe(n,!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pe(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var le,ge,fe,me=process.env.SERVER_PORT||process.env.PORT||4e3;s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return fe=function(t,e,n){e.header("Cache-Control","private, no-cache, no-store, must-revalidate"),e.header("Expires","-1"),e.header("Pragma","no-cache"),n()},t.next=3,s.a.awrap(ce());case 3:return le=t.sent,(ge=p()()).use(l()()),ge.use(f.a.json()),ge.use(f.a.urlencoded({extended:!1})),new m.ApolloServer({schema:Kt,introspection:!0,playground:!0,formatError:function(t){return Error.captureStackTrace(t),console.error(t),t},context:function(t){var e,n,r,a;return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e=t.req).headers.authorization){i.next=15;break}return i.prev=2,r=e.headers.authorization,i.next=6,s.a.awrap(O(r));case 6:return a=i.sent,i.next=9,s.a.awrap(A(a.sub,le));case 9:n=i.sent,i.next=15;break;case 12:i.prev=12,i.t0=i.catch(2),console.error(i.t0);case 15:return i.abrupt("return",de({},le,{user:n}));case 16:case"end":return i.stop()}}),null,null,[[2,12]])}}).applyMiddleware({app:ge}),ge.use("/",p.a.static("dist/web")),ge.get("/env.js",fe,(function(t,e){var n;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:n={},Object.keys(process.env).forEach((function(t){0===t.indexOf("REACT_APP")&&(n[t]=process.env[t])})),e.send("\n\t\t\twindow.env = ".concat(JSON.stringify(n),";\n\t\t"));case 3:case"end":return t.stop()}}))})),ge.get("*",(function(t,e){e.sendFile(u.a.resolve("dist/web","index.html"))})),t.next=15,s.a.awrap(new Promise((function(t){return ge.listen(me,(function(){return t(ge)}))})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}})).then((function(t){console.log("Server started at http://localhost:".concat(me)),console.log("GraphQL           http://localhost:".concat(me,"/graphql"))}))}]);
//# sourceMappingURL=index.js.map